include ../Source/make_opts

ifeq ($(origin GCC),undefined)
GCC=gcc
endif
LIBBPATH=../lib
SRC=$(wildcard numerator*.c)
OBJ=$(patsubst %.c,%.o, $(SRC))
INTEGRANDSRC=$(wildcard integrand*.c)
INTEGRANDOBJ=$(patsubst %.c,%.o, $(INTEGRANDSRC))
LIBRARY=libFORM_numerators.so
INTEGRANDLIBRARY=libFORM_integrands.so

all: $(LIBBPATH)/$(LIBRARY) $(LIBBPATH)/$(INTEGRANDLIBRARY)
numerator: $(LIBBPATH)/$(LIBRARY)
integrand: $(LIBBPATH)/$(INTEGRANDLIBRARY)


CFLAGS=-Wconversion -march=native -O3 -fcx-fortran-rules -fcx-limited-range -lm -lquadmath

%.o: %.c
	$(GCC) -c $(CFLAGS) $< -o $@

$(LIBBPATH)/$(LIBRARY): $(OBJ)
	$(GCC) --shared -fPIC $(CFLAGS) -o $@ $^

$(LIBBPATH)/$(INTEGRANDLIBRARY): $(INTEGRANDOBJ)
	$(GCC) --shared -fPIC $(CFLAGS) -o $@ $^

clean:
	rm -f $(LIBBPATH)/$(LIBRARY)
	rm -f $(LIBBPATH)/$(INTEGRANDLIBRARY)
